<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Web Service</title>
<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<div class=toc>
<UL>
<LI><A href=index.html>[home]</A>
<p>
<li><a href="#vars">Variables</a>
<li><a href="#why">Why These Packages?</a>
</UL>
</div>

<div class=main>
<H1>Web Service</H1>
 
<p><b>ROLE</b> apache

<p>The web service configuration is handled by the "apache" role.
Apache is used as the server and this role sets up SSL keys from Lets
Encrypt using <a href="encrypt.html">certbot</a>.  HTTP and HTTPS are
configured on the standard ports.</p>

<p>The role creates one or more vhosts, along with aliases for each.
The document root for each vhost is
at <code>/var/www/&lt;domain&gt;</code>.  We initialize the root with
an index.html if one is not present.  The files are currently owned by
root, but we create a 'www-data' group for future use when others
might be uploading content.</p>

<P>The default Apache config enables gzip compression, and it is not
recommended to turn it off.  If your website uses cookies, strongly
advise using the SameSite flag to mitigate BREACH (CVE-2013-3587)

<!-- ============================== -->
<H2 class=rule>
<A NAME=vars></A>Variables</H2>

<p>The <code>web_vhosts</code> variable is a list of structs, one for
each root domain, with a main name and any aliases.  It looks
something like this.  If the machine is also
a <a href="mail.html">mail server</a>, be sure to add the name used in
the MX record to the aliases of that domain.</p>

<PRE class=code>
web_vhosts:
  - name: "{{ domain }}"
    aliases:
      - www.{{ domain }}
      - mail.{{ domain }}

  - name: foobar.com
    aliases:
      - www.foobar.com
</PRE>

<p>You can set the <code>apache_modules</code> variable to force
certain modules to be enabled.  The rewrite module is always present.
By default we always redirect http to https, but if you want to
disable that you can set <code>apache_force_https</code> to no.</p>

<PRE class=code>
apache_modules: [ extra, modules, to, load ]

# permanent redirect from http to https
# apache_force_https: yes
</PRE>

<!-- ============================== -->
<H2 class=rule>
<A NAME=why></A>Why These Packages?</H2>

<p>I really didn't give this much thought.  I've been using Apache for
years and am already familiar with it.  I'm sure that Nginx is also a
fine choice.  Any site of mine is likely to be mostly static HTML,
perhaps a few CGI scripts, and unlikely to spark worldwide interest,
so any server would be fine.</p>


<figure>
<img src="images/1995_step_mosaic.png" alt="STEP Data ca. 1995">
<figcaption>Back in 1995, we ran NCSA HTTPs and looked at everything
in Mosaic, uphill, both ways.
</figcaption>
</figure>

<div class=copyright>
<p>Copyright &copy; 2020 David Loffredo, licensed under
<a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
CC BY 4.0</a>.
</p>
</div>
</div>
</body>
</html>
