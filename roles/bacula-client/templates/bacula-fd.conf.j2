#
# Bacula File Daemon Configuration
#
{% for i in groups['backup-server'] %}
{%- set dir = hostvars[i] -%}
{%- set dir_name = dir.bacula_director_name | default(dir.inventory_hostname_short + '-dir') -%}
Director {
  Name = {{ dir_name }}
  Password = "{{ bacula_client_pw }}"
}
{% endfor %}

# Restricted Director, used by tray-monitor to get file daemon status
#Director {
#  Name = bacula-mon
#  Password = "foobar"
#  Monitor = yes
#}

#
# "Global" File daemon configuration specifications
#
FileDaemon {
  Name = {{ bacula_client_name }}
{% if bacula_client_tunnel %}
  FDAddress=127.0.0.1
{% endif %}
  FDPort = {{ bacula_client_fdport }}
  Working Directory = {{ bacula_client_workdir }}
  Pid Directory = {{ bacula_client_piddir }}
  Maximum Concurrent Jobs = {{ bacula_client_max_jobs }}
}

# All messages except skipped files back to primary director
{% for i in ([groups['backup-server'].0]) %}
{%- set dir = hostvars[i] -%}
{%- set dir_name = dir.bacula_director_name | default(dir.inventory_hostname_short + '-dir') -%}
Messages {
  Name = Standard
  director = {{ dir_name }} = all, !skipped, !restored
}
{% endfor %}

